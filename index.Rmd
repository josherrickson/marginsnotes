---
title: "Marginal Effects"
output:
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
    css: style.css
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Introduction

Column
-------------------------------------

### Discussion

Insert discussion.

We'll use the `margex` data set from Stata. See the tabs on the right
for the necessary syntax and code to load the data.

Column {.tabset}
-------------------------------------

### Stata

```{r child = 'introduction.Rmd'}
```

### R

```{r child = 'R_markdown/introduction.Rmd'}
```

# Categorical Variables {data-navmenu="Marginal Means"}

Column {.tabset}
-------------------------------------

### Discussion

When we have a single categorical variable (not involved in an
interaction), one level is excluded as a reference or baseline
category, and the coefficients on the other levels represent the
average difference between those levels and the reference.

### Math

Assume a linear regression set up with a single categorical variable,
\(G\), with three groups. We fit

\[
  E(Y|G) = \beta_0 + \beta_1g_2 + \beta_2g_3,
\]

where \(g_2\) and \(g_3\) are dummy variables representing membership
in groups 2 and 3 respectively (\(g_{2i} = 1\) if observation \(i\)
has \(G = 2\), and equal to 0 otherwise.) Since \(g_1\) is not found
in the model, it is the reference category.

Therefore, \(\beta_0\) represents the average response among the
reference category \(G = 1\). \(\beta_1\) represents the difference in
the average response between groups \(G = 1\) and \(G =
2\). Therefore, \(\beta_0 + \beta_1\) is the average response in group
\(G = 2\). A similar argument can be made about \(\beta_2\) and group
3.


Column {.tabset data-width=680}
-------------------------------------

### Stata

```{r child = 'categorical.Rmd'}
```

### R

```{r child = 'R_markdown/categorical.Rmd'}
```


# Interactions with Categorical Variables {data-navmenu="Marginal Means"}


Column {.tabset}
-------------------------------------

### Discussion

When we have an interaction of categorical variables, we can estimate
the marginal mean in each combination of levels from the two
categorical variables.

Alternatively,

**To do: `atmeans` versus as observed - I believe `emmeans` default is
  `atmeans` while Stata's is as observed.**

### Math


Consider the simplest case, with two binary variables \(Z\) and
\(K\). We fit the model

\[
  E(Y|Z,K) = \beta_0 + \beta_1Z + \beta_2K + \beta_3ZK,
\]

where \(ZK = 0\) only if both \(Z = 1\) and \(K = 1\).

This is functionally equivalent to defining a new variable \(L\),

\[
  L = \begin{cases}
  0, & K = 0 \& Z = 0 \\
  1, & K = 0 \& Z = 1 \\
  2, & K = 1 \& Z = 0 \\
  3, & K = 1 \& Z = 1,
  \end{cases}
\]

and fitting the model

\[
  E(Y|L) = \beta_0 + \beta_1l_1 + \beta_2l_2 + \beta_3l_3.
\]



Column {.tabset data-width=680}
-------------------------------------

### Stata

```{r child = 'categorical_interaction.Rmd'}
```

### R

```{r child = 'R_markdown/categorical_interaction.Rmd'}
```

# Categorical and Continuous Variables {data-navmenu="Marginal Means"}

Column {.tabset}
-------------------------------------

### Discussion

When there are additional continuous variables in the model, we may
wish to obtain the marginal mean at specified levels of the continuous
variable.

Column {.tabset data-width=680}
-------------------------------------

### Stata

```{r child = 'categorical_and_continuous.Rmd'}
```

### R

```{r child = 'R_markdown/categorical_and_continuous.Rmd'}
```

# Categorical and Continuous Interactions {data-navmenu="Marginal Means"}

Column {.tabset}
-------------------------------------

### Discussion

If there is an interaction between a categorical and continuous variable, the code is the same.

Column {.tabset data-width=680}
-------------------------------------

### Stata

```{r child = 'categorical_continuous_interaction.Rmd'}
```

### R

```{r child = 'R_markdown/categorical_continuous_interaction.Rmd'}
```

# No Interactions {data-navmenu="Marginal Slopes"}

Column {.tabset}
-------------------------------------

### Discussion


Column {.tabset data-width=680}
-------------------------------------

### Stata

```{r child = 'slopes_no_interaction.Rmd'}
```

### R

```{r child = 'R_markdown/slopes_no_interaction.Rmd'}
```
